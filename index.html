<!DOCTYPE html>
<html>
    <head>
        <title>Arm Game</title>

        <!-- <footer><small>Copyright Manny Barros, 2015</small></footer> -->

        <meta name="mobile-web-app-capable" content="yes">
        <link href='http://fonts.googleapis.com/css?family=Roboto:100' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="style.css">

        <script type="text/javascript" src="js/paper.js"></script>
        <script type="text/paperscript" canvas="kinematics">
        //Imaginary javadoc:
        //param pos: a paper.js Point
        //param radius: a number (lol weak typing)
        //param color: a color idk lol
        function Joystick(pos, radius, color) {
            this.pos = pos;
            this.radius = radius;
            this.color = color;
            this.setPt = new Point(pos);

            //Drawing unchanging graphical elements
            var bounds = new Path.Circle({
                center: this.pos,
                radius: this.radius,
                strokeColor: 0.8,
                strokeWidth: 5,
                dashArray: [10,4]
            });

            var bulbShadow = new Path.Circle({
                center: this.pos,
                radius: 10,
                fillColor: 0.8
            });

            //Drawing changing graphical elements
            var bulb = new Path.Circle({
                center: pos,
                radius: 10,
                fillColor: this.color
            });

            var xText = new PointText({
                point: [this.pos.x + this.radius + 10,
                        this.pos.y - this.radius],
                fontSize: 20,
                fillColor: 0.8
            });

            var yText = new PointText({
                point: [this.pos.x + this.radius + 10,
                        this.pos.y - this.radius + 20],
                fontSize: 20,
                fillColor: 0.8
            });

            //Getters and setters
            this.getX = function() {
                var delta = this.pos - bulb.position;
                return -Math.round(delta.x / this.radius * 100);
            };

            this.getY = function() {
                var delta = this.pos - bulb.position;
                return Math.round(delta.y / this.radius * 100);
            };

            this.getDelta = function() {
                return this.pos - bulb.position;
            };

            //Event handling workaround
            this.drag = function(point) {
                var extendedBounds = new Path.Circle(this.pos, this.radius + 50);

                if(bounds.contains(point)) {
                    this.setPt = point;
                } else if(extendedBounds.contains(point)) {
                    var theta = Math.atan2(point.x-this.pos.x,this.pos.y-point.y);
                    var radPoint = new Point({
                        x: this.pos.x + this.radius*Math.sin(theta),
                        y: this.pos.y - this.radius*Math.cos(theta)
                    });
                    this.setPt = radPoint;
                } else {
                    this.setPt = this.pos;
                }
            };

            this.mouseUp = function(point) {
                this.setPt = this.pos;
            };

            this.frame = function(point) {
                var vector = this.setPt - bulb.position;
                bulb.position += vector / 5;
                xText.content = "x: " + this.getX();
                yText.content = "y: " + this.getY();
            };
        }

        var XYpos = new Joystick(new Point(110, view.size.height - 110), 80, '#FF4444');
        var Zpos = new Joystick(new Point(view.size.width - 150, XYpos.pos.y), 80, "#33B5E5");

        var segLen = 200;

        var bg = new Layer();

        var shoulder = new Point(view.center.x, view.size.height/20);

        var range = new Path.Circle({
            center: shoulder,
            layer: bg,
            radius: 2*segLen,
            fillColor: '#000',
            opacity: 0.1,
        });

        range.removeSegment(1);
        range.segments[0].handleOut = [segLen,0];
        range.segments[1].handleIn = [-segLen,0];

        var dotA = new Path.Circle({
            center: range.bounds.center,
            radius: 10,
            fillColor: '#AA66CC',
            // opacity: 0.5
        });

        function onMouseDrag(event) {
            XYpos.drag(event.point);
            Zpos.drag(event.point);
        }

        function onMouseUp(event) {
            XYpos.mouseUp(event.point);
            Zpos.mouseUp(event.point);
        }

        function onFrame(event) {
            XYpos.frame(event.point);
            Zpos.frame(event.point);

            if(range.contains(dotA.position - XYpos.getDelta()/5)) {
                dotA.position -= XYpos.getDelta()/5;
            } else {
                dotA.position +=XYpos.getDelta()/1000;
            }
        }

        </script>
    </head>

    <body>
        <div align="center">
            <!-- <h1 id="title">Arm Game</h1> -->
            <canvas keepAlive="true" resize="true" id="kinematics"></canvas>
        </div>
    </body>
</html>
